<DeploymentModel  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">

  <!--
      Test Command
      Inst4WA.exe -XmlConfigPath "HelloWorldWebRoleWR.xml" -Subscription "<subscription name>" -DomainName "<domain name>" 
  -->
  <Parameters>
    <Parameter Name="Emulator" Value="false"></Parameter>
    <Parameter Name="Subscription" Value="" Required="yes"></Parameter>
    <Parameter Name="DomainName" Value="HelloWorldWebRole" Required="yes"></Parameter>
    <Parameter Name="StorageAccountName" ValuePrefixRef="DomainName" ValueSuffix="stg" Required="yes"></Parameter>
    <Parameter Name="DeploymentName" ValuePrefixRef="DomainName" ValueSuffix="deploy" Required="yes"></Parameter>
    <Parameter Name="Region" Value="North Central US"></Parameter>
    <Parameter Name="DeploymentOption" Value="Production"></Parameter>
    <Parameter Name="PublishSettingsFilePath" Value="Azure.publishsettings"></Parameter>
    
    <Parameter Name="AzureDeploymentCmdletsAssemblyPath"
               Value="%%Program Files%%\Microsoft SDKs\Windows Azure\PowerShell\Azure\Microsoft.WindowsAzure.Management.CloudService.dll" Required="yes"></Parameter>
    <Parameter Name="AzureMgmtCmdletsAssemblyPath"
           Value="%%Program Files%%\Microsoft SDKs\Windows Azure\PowerShell\Azure\Microsoft.WindowsAzure.Management.dll" Required="yes"></Parameter>

    <Parameter Name="AppFolder" Value="C:\temp\WebRoleOnAzure"></Parameter>
    <Parameter Name="AppName" Value="HelloWorld"></Parameter>

    <Parameter Name="RoleBinaries" Value="TestData\WebRole\Bin"></Parameter>
    <Parameter Name="CSCFGFile" Value="TestData\WebRole\ServiceConfiguration.Local.cscfg"></Parameter>
    <Parameter Name="CSDEFFile" Value="TestData\WebRole\ServiceDefinition.csdef"></Parameter>
    
    <Parameter Name="RoleName" Value="WebRole"></Parameter>
    <Parameter Value="%%Program Files%%\Microsoft SDKs\Windows Azure\PowerShell\Azure" Name="AzureNodeJsSdkPath"/>
  </Parameters>
  <Steps>

    <Step Type="Cmdlet" Command="Install-AzureSdkForNodeJs" Message="Installing Windows Azure PowerShell for Node.JS">
      <CommandParam Name="AzureNodeSdkLoc" ParameterName="AzureNodeJsSdkPath" />
    </Step>

    <!--Load Azure SDK Dll's-->
    <Step Type="Cmdlet" Command="Add-LoadAssembly" Message="Loading Windows Azure PowerShell for Node.JS">
      <CommandParam Name="CmdletsAssemblyPath" ParameterName="AzureDeploymentCmdletsAssemblyPath" />
    </Step>
    <Step Type="Cmdlet" Command="Add-LoadAssembly" Message="Loading Windows Azure PowerShell for Node.JS">
      <CommandParam Name="CmdletsAssemblyPath" ParameterName="AzureMgmtCmdletsAssemblyPath" />
    </Step>
    <Step Type="Cmdlet" Command="Import-AzurePublishSettingsFile" Message="Importing Publish settings">
      <CommandParam Name="PublishSettingsFile" ParameterName="PublishSettingsFilePath" />
    </Step>
    
    <!--Create Empty App-->
    <Step Type="Cmdlet" Command="New-ApplicationDirectory" Message="Creating application directory">
      <CommandParam Name="AppFolder" ParameterName="AppFolder" />
    </Step>
    <Step Message="Changing to application directory" Command="" Type="ChangeWorkingDir">
      <CommandParam Name="WorkingDir" ParameterName="AppFolder"/>
    </Step>
    <Step Message="Creating new Azure service" Command="New-AzureServiceProject" Type="Cmdlet">
      <CommandParam Name="ServiceName" ParameterName="AppName"/>
    </Step>

    <!--Create Web Role-->
    <Step Type="Cmdlet" Command="Add-AzureWebRole" Message="Creating hello world web role.">
      <CommandParam Name="RoleBinariesFolder" ParameterName="RoleBinaries" />
      <CommandParam Name="CSCFGFile" ParameterName="CSCFGFile" />
      <CommandParam Name="CSDEFFile" ParameterName="CSDEFFile" />
      <CommandParam Name="RoleName" ParameterName="RoleName" />
    </Step>

    <!--Configure storage account and deploy-->
    <Step Type="Cmdlet" Command="Set-AzureStorageAccount" Message="Configuring azure storage account">
      <CommandParam Name="PublishSettingsFile" ParameterName="PublishSettingsFilePath" />
      <CommandParam Name="Subscription" ParameterName="Subscription" />
      <CommandParam Name="StorageAccount" ParameterName="StorageAccountName" />
      <CommandParam Name="Location" ParameterName="Region" />
    </Step>
    
    <Step Type="Cmdlet" Command="Publish-AzureServiceProject -launch" Message="Deploying the app to Azure">
      <CommandParam Name="ServiceName" ParameterName="DeploymentName" />
      <CommandParam Name="StorageAccountName" ParameterName="StorageAccountName" />
      <CommandParam Name="Slot" ParameterName="DeploymentOption" />
      <CommandParam Name="Location" ParameterName="Region" />
      <CommandParam Name="Subscription" ParameterName="Subscription" />
    </Step>
    <Step Type="Cmdlet" Command="Ping-ServiceEndpoints" Message="Verifying the Endpoints.">
      <CommandParam Name="PublishSettingsFile" ParameterName="PublishSettingsFilePath" />
      <CommandParam Name="Subscription" ParameterName="Subscription" />
      <CommandParam Name="ServiceName" ParameterName="DeploymentName" />
    </Step>
  </Steps>
</DeploymentModel>